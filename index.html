<!doctype html>
<html>
  <head>
    <title>Ultimate Werewolf</title>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <script>
        $(function () { // Ensures script only called when DOM is ready

            // Check if client support Web Storage. Need it to store data
            if (typeof(Storage) === "undefined") {
              console.log("Error: No Web Storage support!");
            }
            // Create web socket connection
            let socket = io();

            // Check existing session storage for data. 
            let clientId = sessionStorage.getItem("client-id");
            let gameSessionId = sessionStorage.getItem("game-session-id");

            socket.on('numbers-update', function(randNum) {
              $('#displaynum').text(randNum);
            });

            socket.on("client-id", function(id) {
              clientId = id;
              // Store it in session storage
              sessionStorage.setItem("client-id", clientId);
              // Display it
              $("#client-id").text(clientId);
            });

            socket.on("game-session-id", function(id) {
              console.log("received game session id from server: " + id);
              gameSessionId = id;
              sessionStorage.setItem("game-session-id", gameSessionId);
              $("#game-session-id").text(gameSessionId);
            });

            socket.on("server-msg", function(serverData) {
              let currentTxt = $("#server-msgs").text;
              $("#server-msgs").text(serverData + "<br>" + currentText);
            });

            $("#connect-to-server").click( function() {
              console.log("connect to server button clicked.");
              let clientMsg = createBasicMsg();
              socket.emit("ask-client-id", clientMsg);
            });

            $("#join-game").click( function() {
              let clientMsg = createBasicMsg();
              socket.emit("ask-game-id", clientMsg);
            });

            // Create standard client msg that can modify before sending to server
            function createBasicMsg() {
              let clientMsg = {};
              clientMsg.clientId = sessionStorage.getItem("client-id");
              clientMsg.gameSessionId = sessionStorage.getItem("game-session-id");
              return clientMsg;
            }
        });
    </script>
    <h1>Welcome to Ultimate Werewolf</h1>
  </head>
  <body>
    <p>
      Client ID: <span id="client-id"></span>
    </p>
    <p>
    Server sent number: <span id="displaynum">no data yet</span>
    </p>
    <p>
      <input type="text" placeholder="Enter name"></input><br>
      <button id="connect-to-server" type="button">Connect to Server</button>
    </p>
    <p>
      Game Session ID: <span id="game-session-id"></span><br>
      <button id="join-game" type="button">Join a Game</button>
    </p>
    <p>
      Server Messages:
      <span id="#server-msgs"></span>
    </p>
  </body>
</html>